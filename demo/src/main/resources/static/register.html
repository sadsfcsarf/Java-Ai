<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/elementIndex.css">
    <link rel="stylesheet" href="css/elementUiIndex2.css">
    <style>
        .login-container {
            /*弹性布局*/
            display: flex;
            /*子元素在水平方向保持居中*/
            justify-content: center;
            /*子元素在容器的垂直方向中间对齐*/
            align-items: center;
            background: #eee;
            /*设置元素高度为可视化容器的100%*/
            height: 100vh;
        }

        .login-center {
            width: 400px;
            padding: 20px;
        }

        .title {
            font-size: 22px;
            text-align: center;
            margin-bottom: 30px;
            color: #4db3ff;
        }
        p{
            text-align: center;
        }
        p a{
            color: #409EFF;
        }
    </style>
</head>
<body>
<!--划定最大范围-->
<div id="app">
    <template>
        <div class="login-container">
            <el-card class="login-center" shadow="hover">
                <div class="title">用户注册</div>
                <el-form :model="loginForm" :rules="rules" ref="ruleForm" @keyup.enter.native="register">
                    <!-- prop:当前表单项使用的效验规则的那一属性-->
                    <el-form-item prop="username">
                        <el-input v-model="loginForm.username" placeholder="请输入用户名"></el-input>
                    </el-form-item>
                    <el-form-item prop="password">
                        <el-input v-model="loginForm.password" placeholder="请输入密码" type="password"
                                  show-password></el-input>
                    </el-form-item>
                    <el-form-item prop="confirmPass">
                        <el-input v-model="loginForm.confirmPass" placeholder="请再次输入密码" show-password></el-input>
                    </el-form-item>
                    <el-form-item prop="nickname">
                        <el-input v-model="loginForm.nickname" placeholder="请输入昵称" ></el-input>
                    </el-form-item>
                    <el-form-item prop="sex">
                        <el-select v-model="loginForm.sex" placeholder="请选择性别">
                            <el-option label="男" value="男"></el-option>
                            <el-option label="女" value="女"></el-option>
                            <el-option label="未知" value="未知"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item prop="phone">
                        <el-input v-model="loginForm.phone" placeholder="请输入手机号"></el-input>
                    </el-form-item>

                    <el-form-item>
                        <el-button type="primary" style="width: 100%" @click="register">注册</el-button>
                        <p>已有账号？<a href="/login.html">去登录</a></p>
                    </el-form-item>
                </el-form>
            </el-card>
        </div>
    </template>
</div>
<script src="js/jquery-3.2.1.js"></script>
<script src="js/elementVue.js"></script>
<script src="js/elementIndex.js"></script>
<script>
    //创建Vue对象
    new Vue({
        el: "#app", //Vue生效范围
        //在data中定义页面上使用的变量
        data() {
            var pass2 = (rule, value, callback) => {
                //非空校验
                if (value==null) {
                    callback(new Error('请再次输入密码'));
                }
                if (value !== this.loginForm.password) {
                    callback(new Error('两次输入密码不一致!'));
                }
                callback();
            };
            return {
                //接收登录表单的变量
                loginForm: {},
                rules:{
                    username: [
                        { required: true, message: '用户名不能为空', trigger: 'blur' }
                    ],
                    password: [
                        { required: true, message: '密码不能为空', trigger: 'blur' }
                    ],
                    confirmPass: [
                        { validator: pass2, trigger:['blur', 'change']}
                    ],
                    nickname: [
                        { required: true, message: '昵称不能为空', trigger: 'blur' }
                    ],
                    sex: [
                        { required: true, message: '请选择性别', trigger: 'blur' }
                    ],
                    phone: [
                        { required: true, message: '手机号不能为空', trigger: 'blur' },
                        { pattern: /^1[3456789][0-9]{9}$/, message: '请输入正确的手机号', trigger: ['blur', 'change']}
                    ]

                }
            }
        },
        methods: {
            //注册方法
            register() {
                //校验指定表中是否校验规则,valid为true表示校验通过，不符合规则，返回false
                this.$refs.ruleForm.validate(valid=>{
                    if(valid){
                        var that = this;
                        //通过ajax
                        $.ajax({
                            url: "/api/user/register",
                            type: "post",
                            data: this.loginForm,
                            success(res) {
                                console.log(res)
                                if (res.code == 200) {
                                    //登录成功
                                    that.$message({
                                        message: "注册成功"
                                        , type: "success"
                                    })
                                    //跳转到登录页面
                                    setTimeout(()=>{
                                        window.location.href = "./login.html"
                                    }, 1000)
                                } else {
                                    //登录失败
                                    that.$message({
                                        message: res.msg
                                        , type: "error"
                                    })

                                }
                            }
                        })
                    }

                })

            }
        }
    })
</script>
</body>
</html>